<?xml version="1.0" encoding="UTF-8"?>
<Subscription xmlns="http://schemas.microsoft.com/2006/03/windows/events/subscription">
    <SubscriptionId>Sysmon - Networking</SubscriptionId>
    <SubscriptionType>SourceInitiated</SubscriptionType>
    <Description>Provides visibility network connections</Description>
    <Enabled>false</Enabled>
    <Uri>http://schemas.microsoft.com/wbem/wsman/1/windows/EventLog</Uri>
    <ConfigurationMode>MinLatency</ConfigurationMode>
    <Query><![CDATA[
<QueryList>
   <!-- Include Sysmon network events, but exclude events generated by logging collection (WinRM) -->
  <Query Id="0" Path="Microsoft-Windows-Sysmon/Operational">
    <Select Path="Microsoft-Windows-Sysmon/Operational">
    *[System[(EventID=3)]]
    </Select>
    <Suppress Path="Microsoft-Windows-Sysmon/Operational">
        <!-- Exclude capturing event forwarding -->
        (*[EventData[Data[@Name='Image'] = 'C:\Windows\System32\svchost.exe' and Data[@Name='DestinationPort']='5985']]) or
        
        <!-- Exclude common local networking activity generated by system accounts -->
        (
            (*[EventData[
                Data[@Name='User'] = 'NT AUTHORITY\SYSTEM' or
                Data[@Name='User'] = 'NT AUTHORITY\LOCAL SERVICE' or
                Data[@Name='User'] = 'NT AUTHORITY\NETWORK SERVICE'
            ]]) and
            (*[EventData[
                Data[@Name='DestinationPort']=53 or <!--Filter DNS -->
                Data[@Name='DestinationPort']=67 or <!--Filter BOOTP -->
                Data[@Name='DestinationPort']=68 or <!--Filter BOOTP -->
                Data[@Name='DestinationPort']=88 or <!--Filter Kerberos -->
                Data[@Name='DestinationPort']=123 or <!--Filter NTP -->
                Data[@Name='DestinationPort']=135 or <!--Filter DCOM Service Control Manager -->
                Data[@Name='DestinationPort']=137 or <!--Filter SMB/NetBIOS -->
                Data[@Name='DestinationPort']=138 or <!--Filter SMB/NetBIOS -->
                Data[@Name='DestinationPort']=139 or <!--Filter SMB/NetBIOS -->
                Data[@Name='DestinationPort']=389 or <!--Filter LDAP -->
                Data[@Name='DestinationPort']=445 or <!--Filter SMB/NetBIOS -->
                Data[@Name='DestinationPort']=546 or <!--Filter dhcpv6-client -->
                Data[@Name='DestinationPort']=547 or <!--Filter dhcpv6-server -->
                Data[@Name='DestinationPort']=5355 or <!--Filter LLMNR -->
                Data[@Name='DestinationPort']=1900  <!--Filter UPnP -->
            ]])
        )
    </Suppress>
  </Query>
</QueryList>
]]>
    </Query>
    <ReadExistingEvents>true</ReadExistingEvents>
    <TransportName>HTTP</TransportName>
    <ContentFormat>Events</ContentFormat>
    <Locale Language="en-US"/>
    <LogFile>ForwardedEvents</LogFile>
    <PublisherName>Microsoft-Windows-EventCollector</PublisherName>
    <AllowedSourceNonDomainComputers>
        <AllowedIssuerCAList>
        </AllowedIssuerCAList>
    </AllowedSourceNonDomainComputers>
    <AllowedSourceDomainComputers></AllowedSourceDomainComputers>
</Subscription>
